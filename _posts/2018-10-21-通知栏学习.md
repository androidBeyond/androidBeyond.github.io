---
layout:     post
title:      android通知栏解析学习
subtitle:   8.0系统后使用通知栏需要先创建渠道，多渠道可以设置渠道组进行管理
date:       2018-10-21
author:     duguma
header-img: img/article-bg.jpg
top: false
catalog: true
tags:
    - Android
    - 组件学习
--- 


<ol><li>8.0系统后使用通知栏需要先创建渠道&#xff0c;多渠道可以设置渠道组进行管理。</li><li>如果你项目的targetSdkVersion&gt;&#61;26&#xff0c;如果没有进行渠道适配&#xff0c;将完全无法弹出通知栏。</li><li>如果targetSdkVersion&gt;&#61;26&#xff0c;且升级了Android核心库&#xff0c;那么原来的通知栏构造方法会显示为废弃方法&#xff0c;需要多传一个渠道Id&#xff0c;如果该渠道Id没有提前创建&#xff0c;否则会异常。</li></ol> 
<p><img src="https://img-blog.csdnimg.cn/2020021221431438.png?x-oss-process&#61;image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlTW9ubGl1aHVp,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p> 
<h4><a id="_7"></a>创建通知栏渠道组</h4> 
<ol><li>两个参数&#xff1a;渠道组id&#xff0c;渠道组在通知栏管理里面显示的名字name。</li><li>创建了渠道组后&#xff0c;8.0系统通知栏管理渠道会分组显示。</li><li>渠道组除了在通知栏里面会分组显示外&#xff0c;暂时没有发现有其他额外的功能&#xff0c;也可以不创建。</li></ol> 
<pre><code class="prism language-kotlin"><span class="token annotation builtin">&#64;TargetApi</span><span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">createNotificationChannelGroup</span><span class="token punctuation">(</span>id<span class="token operator">:</span> String<span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">val</span> manager<span class="token operator">:</span> NotificationManager <span class="token operator">&#61;</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager
        <span class="token keyword">val</span> channel <span class="token operator">&#61;</span> <span class="token function">NotificationChannelGroup</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        manager<span class="token punctuation">.</span><span class="token function">createNotificationChannelGroup</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_21"></a>创建通知栏渠道</h4> 
<ol><li>三个个参数&#xff1a;渠道id&#xff0c;渠道在通知栏管理里面显示的名字name&#xff0c;渠道重要等级详情见下文。</li><li>可以通过<code>channel.group &#61; groupId</code>设置该渠道所属的渠道组&#xff0c;但是需要先创建渠道组&#xff0c;否则会异常。</li><li>渠道也可以不设置渠道组&#xff0c;不会有任何影响。不设置的渠道会统一系统默认的渠道组下。</li></ol> 
<pre><code class="prism language-kotlin"> <span class="token annotation builtin">&#64;TargetApi</span><span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span>
     <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">createNotificationChannel</span><span class="token punctuation">(</span>id<span class="token operator">:</span> String<span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> importance<span class="token operator">:</span> Int<span class="token punctuation">,</span> groupId<span class="token operator">:</span> String <span class="token operator">&#61;</span> <span class="token string">&#34;&#34;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">val</span> manager<span class="token operator">:</span> NotificationManager <span class="token operator">&#61;</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager
         <span class="token keyword">val</span> channel <span class="token operator">&#61;</span> <span class="token function">NotificationChannel</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> importance<span class="token punctuation">)</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>groupId<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
             channel<span class="token punctuation">.</span>group <span class="token operator">&#61;</span> groupId <span class="token comment">//设置该渠道所属的渠道组</span>
         <span class="token punctuation">}</span>
         manager<span class="token punctuation">.</span><span class="token function">createNotificationChannel</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_39"></a>渠道重要等级</h4> 
<ol><li>8.0以前通知栏的提示音&#xff0c;提示音&#xff0c;振动&#xff0c;呼吸灯等效果使用方法setDefaults()&#xff0c;setSound()&#xff0c;setVibrate()等方法设置的&#xff1b;悬浮框,是否折叠等效果则是由setPriority()设置优先级函数来控制的&#xff1b;<br /> 但是这些函数在8.0以后会失效&#xff0c;而是使用由渠道重要等级来代替。</li><li>8.0以前通知栏需要setPriority()优先级&gt;&#61;PRIORITY_DEFAULT&#xff0c;并且设置了setDefaults()&#xff0c;setSound()&#xff0c;setVibrate()等方法设置才会有提示音。</li><li>8.0以后&#xff0c;需要合理设置渠道重要等级&#xff0c;合理划分&#xff0c;不重要的通知应设置低等级&#xff0c;避免频繁骚扰而被关闭。</li><li>渠道重要等级的提示效果只在8.0以上起作用&#xff0c;为了兼容低版本系统&#xff0c;最好是合理设置渠道重要等级的同时使用setDefaults()&amp;setPriority()等函数设置提示效果。</li></ol> 
<table><thead><tr><th align="left">渠道重要等级</th><th align="left">值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">NotificationManager.IMPORTANCE_NONE</td><td align="left">0</td><td align="left">通知栏完全不显示&#xff0c;没有提示。也是通知栏管理设置为关闭时的状态。</td></tr><tr><td align="left">NotificationManager.IMPORTANCE_MIN</td><td align="left">1</td><td align="left">通知栏会被折叠显示&#xff0c;没有提示。</td></tr><tr><td align="left">NotificationManager.IMPORTANCE_LOW</td><td align="left">2</td><td align="left">通知栏正常显示&#xff0c;但是没有提示。</td></tr><tr><td align="left">NotificationManager.IMPORTANCE_DEFAULT</td><td align="left">3</td><td align="left">通知栏正常显示,有提示。</td></tr><tr><td align="left">NotificationManager.IMPORTANCE_HIGH</td><td align="left">4</td><td align="left">通知栏正常显示,提示&#xff0c;屏幕上方还会有悬浮弹框。</td></tr><tr><td align="left">NotificationManager.IMPORTANCE_MAX</td><td align="left">5</td><td align="left">源码注释&#xff1a;Unused&#xff0c;没用。最大等级&#xff0c;测试效果上与IMPORTANCE_HIGH完全一致。</td></tr></tbody></table>
<h4><a id="_56"></a>删除渠道组及渠道</h4> 
<pre><code class="prism language-kotlin"> <span class="token keyword">val</span> manager<span class="token operator">:</span> NotificationManager <span class="token operator">&#61;</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager
  manager<span class="token punctuation">.</span><span class="token function">deleteNotificationChannel</span><span class="token punctuation">(</span>channelId<span class="token punctuation">)</span> <span class="token comment">//删除渠道</span>
            manager<span class="token punctuation">.</span><span class="token function">deleteNotificationChannelGroup</span><span class="token punctuation">(</span>groupId<span class="token punctuation">)</span>  <span class="token comment">//删除渠道组</span>
</code></pre> 
<ol><li>我们可以通过上述两个方法删除渠道和渠道组。</li><li>但是这个功能非常不建议大家使用。因为Google为了防止应用程序随意地创建垃圾通知渠道&#xff0c;会在通知设置界面显示所有被删除的通知渠道数量&#xff0c;</li><li>所以对于开发者来说最好的做法就是仔细规划好通知渠道&#xff0c;而不要轻易地使用删除功能。</li></ol> 
<h3><a id="_68"></a>通知栏权限</h3> 
<blockquote> 
 <p>Api 24以上&#xff0c;NotificationManager提供了 areNotificationsEnabled()方法检测通知权限。<br /> support包已经考虑了以上场景&#xff0c;在 24.1.0 开放了areNotificationsEnabled()&#xff0c;在19以下默认返回true,19-24返回对应反射值&#xff0c;24以上用原生NotificationManager检测。</p> 
</blockquote> 
<h4><a id="areNotificationsEnabled_73"></a>areNotificationsEnabled源码</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">NotificationManagerCompat</span> <span class="token punctuation">{<!-- --></span>
 <span class="token comment">//...</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">areNotificationsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;&#61;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> mNotificationManager<span class="token punctuation">.</span><span class="token function">areNotificationsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;&#61;</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            AppOpsManager appOps <span class="token operator">&#61;</span>
                    <span class="token punctuation">(</span>AppOpsManager<span class="token punctuation">)</span> mContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>APP_OPS_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ApplicationInfo appInfo <span class="token operator">&#61;</span> mContext<span class="token punctuation">.</span><span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String pkg <span class="token operator">&#61;</span> mContext<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> uid <span class="token operator">&#61;</span> appInfo<span class="token punctuation">.</span>uid<span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> appOpsClass <span class="token operator">&#61;</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>AppOpsManager<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Method checkOpNoThrowMethod <span class="token operator">&#61;</span> appOpsClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>CHECK_OP_NO_THROW<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span>
                        Integer<span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Field opPostNotificationValue <span class="token operator">&#61;</span> appOpsClass<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>OP_POST_NOTIFICATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> value <span class="token operator">&#61;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> opPostNotificationValue<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Integer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> checkOpNoThrowMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>appOps<span class="token punctuation">,</span> value<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> pkg<span class="token punctuation">)</span>
                        <span class="token operator">&#61;&#61;</span> AppOpsManager<span class="token punctuation">.</span>MODE_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> <span class="token operator">|</span> NoSuchMethodException <span class="token operator">|</span> NoSuchFieldException
                    <span class="token operator">|</span> InvocationTargetException <span class="token operator">|</span> IllegalAccessException <span class="token operator">|</span> RuntimeException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol><li>使用<code>NotificationManagerCompat.from(App.appContext).areNotificationsEnabled()</code>方法即可获得应用是否被关闭通知栏。</li></ol> 
<p>2.8.0以上只有关闭应用通知栏才会返回false&#xff0c;关闭某一个渠道并不会改变该函数的返回值。<br /> 3.获取某一渠道是否被关闭&#xff0c;可以通过判断渠道重要等级来判断,如下代码。</p> 
<pre><code class="prism language-kotlin"> <span class="token annotation builtin">&#64;RequiresApi</span><span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">isNotificationEnabledV26</span><span class="token punctuation">(</span>channelId<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
        runCatching <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">val</span> manager<span class="token operator">:</span> NotificationManager <span class="token operator">&#61;</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager
            <span class="token keyword">val</span> channel <span class="token operator">&#61;</span> manager<span class="token punctuation">.</span><span class="token function">getNotificationChannel</span><span class="token punctuation">(</span>channelId<span class="token punctuation">)</span>
            <span class="token keyword">return</span> channel<span class="token punctuation">.</span>importance <span class="token operator">!&#61;</span> NotificationManager<span class="token punctuation">.</span>IMPORTANCE_NONE
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">onFailure</span> <span class="token punctuation">{<!-- --></span>
            it<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_125"></a>应用内打开通知栏管理界面</h3> 
<h4><a id="_127"></a>打开应用的通知栏权限设置界面</h4> 
<pre><code class="prism language-kotlin"><span class="token keyword">fun</span> <span class="token function">openNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token keyword">val</span> pkg<span class="token operator">:</span> String <span class="token operator">&#61;</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>packageName
    <span class="token keyword">val</span> intent <span class="token operator">&#61;</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    intent<span class="token punctuation">.</span>flags <span class="token operator">&#61;</span> Intent<span class="token punctuation">.</span>FLAG_ACTIVITY_NEW_TASK
                    <span class="token keyword">when</span> <span class="token punctuation">{<!-- --></span>
                        Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;&#61;</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                            intent<span class="token punctuation">.</span>action <span class="token operator">&#61;</span> Settings<span class="token punctuation">.</span>ACTION_APP_NOTIFICATION_SETTINGS
                            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span>Settings<span class="token punctuation">.</span>EXTRA_APP_PACKAGE<span class="token punctuation">,</span> pkg<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                        Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&#61;&#61;</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>KITKAT <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                            intent<span class="token punctuation">.</span>action <span class="token operator">&#61;</span> Settings<span class="token punctuation">.</span>ACTION_APPLICATION_DETAILS_SETTINGS
                            intent<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>CATEGORY_DEFAULT<span class="token punctuation">)</span>
                            intent<span class="token punctuation">.</span>data <span class="token operator">&#61;</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&#34;package:<span class="token interpolation variable">$pkg</span>&#34;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                            intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>FLAG_ACTIVITY_NEW_TASK<span class="token punctuation">)</span>
                            intent<span class="token punctuation">.</span>action <span class="token operator">&#61;</span> Settings<span class="token punctuation">.</span>ACTION_APPLICATION_DETAILS_SETTINGS
                            intent<span class="token punctuation">.</span>data <span class="token operator">&#61;</span> Uri<span class="token punctuation">.</span><span class="token function">fromParts</span><span class="token punctuation">(</span><span class="token string">&#34;package&#34;</span><span class="token punctuation">,</span> pkg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="80_154"></a>8.0打开某一渠道的通知栏权限设置界面</h4> 
<pre><code class="prism language-kotlin"> <span class="token comment">/**
     * 直接打开对应渠道Id的设置界面
     */</span>
    <span class="token annotation builtin">&#64;RequiresApi</span><span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span>
    <span class="token keyword">fun</span> <span class="token function">openNotificationByChannelId</span><span class="token punctuation">(</span>channelId<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> intent <span class="token operator">&#61;</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        intent<span class="token punctuation">.</span>flags <span class="token operator">&#61;</span> Intent<span class="token punctuation">.</span>FLAG_ACTIVITY_NEW_TASK
        intent<span class="token punctuation">.</span>action <span class="token operator">&#61;</span> Settings<span class="token punctuation">.</span>ACTION_CHANNEL_NOTIFICATION_SETTINGS
        intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span>Settings<span class="token punctuation">.</span>EXTRA_APP_PACKAGE<span class="token punctuation">,</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>packageName<span class="token punctuation">)</span>
        intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span>Settings<span class="token punctuation">.</span>EXTRA_CHANNEL_ID<span class="token punctuation">,</span> channelId<span class="token punctuation">)</span>
        App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_172"></a>通知栏</h3> 
<h4><a id="_174"></a>完整的创建通知栏的代码</h4> 
<p><strong>通知栏通知函数NotificationManager.notify(int id, Notification notification),id必须是唯一的&#xff0c;否则只会显示最新的通知。</strong></p> 
<pre><code class="prism language-kotlin">        <span class="token comment">//点击通知栏消息跳转页</span>
        <span class="token keyword">val</span> intent <span class="token operator">&#61;</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> MainActivity<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
        <span class="token keyword">val</span> pendingIntent <span class="token operator">&#61;</span> PendingIntent<span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> intent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> manager<span class="token operator">:</span> NotificationManager <span class="token operator">&#61;</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager
        <span class="token keyword">val</span> notification <span class="token operator">&#61;</span> NotificationCompat<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> NotificationHelper<span class="token punctuation">.</span>VIDEO<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setContentTitle</span><span class="token punctuation">(</span><span class="token string">&#34;视频消息&#34;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setContentText</span><span class="token punctuation">(</span><span class="token string">&#34;收到一条视频消息&#xff0c;等级MAX&#xff01;&#xff01;&#xff01;&#34;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setWhen</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setLargeIcon</span><span class="token punctuation">(</span>BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>resources<span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_launcher_large<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setAutoCancel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setContentIntent</span><span class="token punctuation">(</span>pendingIntent<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDefaults</span><span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>DEFAULT_ALL<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span>NotificationCompat<span class="token punctuation">.</span>PRIORITY_MAX<span class="token punctuation">)</span>
                 <span class="token comment">/* .setGroup(NotificationHelper.CHAT)
                     .setGroupSummary(true)*/</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            manager<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> notification<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_198"></a>常用方法:</h4> 
<p>setContentTitle(CharSequence)&#xff1a;设置标题<br /> setContentText(CharSequence)&#xff1a;设置内容<br /> setSubText(CharSequence)&#xff1a;设置内容下面一小行的文字<br /> setTicker(CharSequence)&#xff1a;设置收到通知时在顶部显示的文字信息<br /> setWhen(long)&#xff1a;设置通知时间&#xff0c;一般设置的是收到通知时的System.currentTimeMillis()<br /> setSmallIcon(int)&#xff1a;设置右下角的小图标&#xff0c;在接收到通知的时候顶部也会显示这个小图标<br /> setLargeIcon(Bitmap)&#xff1a;设置左边的大图标<br /> setAutoCancel(boolean)&#xff1a;用户点击Notification点击面板后是否让通知取消(默认不取消)</p> 
<h4><a id="80_208"></a>8.0以下设置通知提示</h4> 
<blockquote> 
 <p>setDefaults(int)&#xff1a;向通知添加声音、闪灯和振动效果的最简单、使用默认&#xff08;defaults&#xff09;属性&#xff0c;可以组合多个属性。<br /> setDefaults(Notification.DEFAULT_SOUND) //获取默认铃声<br /> Notification.DEFAULT_VIBRATE(添加默认震动提醒)&#xff1b;<br /> Notification.DEFAULT_SOUND(添加默认声音提醒)&#xff1b;<br /> Notification.DEFAULT_LIGHTS(添加默认三色灯/呼吸灯提醒)<br /> Notification.DEFAULT_ALL(添加默认以上3种全部提醒)</p> 
 <p>setVibrate(long[])&#xff1a;设置振动方式&#xff0c;比如&#xff1a;setVibrate(new long[] {0,300,500,700});延迟0ms&#xff0c;然后振动300ms&#xff0c;在延迟500ms&#xff0c;接着再振动700ms。<br /> setLights(int argb, int onMs, int offMs)&#xff1a;设置三色灯&#xff0c;参数依次是&#xff1a;灯光颜色&#xff0c;亮持续时间&#xff0c;暗的时间&#xff0c;不是所有颜色都可以&#xff0c;这跟设备有关&#xff0c;有些手机还不带三色灯&#xff1b;<br /> 另外&#xff0c;还需要为Notification设置flags为Notification.FLAG_SHOW_LIGHTS才支持三色灯提醒&#xff01;</p> 
 <p>setSound(Uri)&#xff1a;设置接收到通知时的铃声&#xff0c;可以用系统的&#xff0c;也可以自己设置&#xff0c;例子如下:<br /> setSound(Uri.parse(“file:///sdcard/xx/xx.mp3”)) //获取自定义铃声<br /> setSound(Uri.withAppendedPath(Audio.Media.INTERNAL_CONTENT_URI, “5”))//获取Android多媒体库内的铃声</p> 
</blockquote> 
<p><strong>8.0以前通知栏需要setPriority()优先级&gt;&#61;PRIORITY_DEFAULT&#xff0c;并且设置了setDefaults()&#xff0c;setSound()&#xff0c;setVibrate()等方法设置才会有提示音。</strong></p> 
<h4><a id="80_227"></a>8.0一下设置优先级</h4> 
<blockquote> 
 <p>setPriority(int)&#xff1a;优先级决定是否显示顶部悬浮框&#xff0c;是否状态栏显示图标</p> 
</blockquote> 
<p><strong>8.0以前通知栏需要setPriority()优先级&gt;&#61;PRIORITY_DEFAULT&#xff0c;并且设置了setDefaults()&#xff0c;setSound()&#xff0c;setVibrate()等方法设置才会有提示音。</strong></p> 
<table><thead><tr><th align="left">优先级</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">NotificationCompat.PRIORITY_MAX</td><td align="left">重要而紧急的通知&#xff0c;通知用户这个事件是时间上紧迫的或者需要立即处理的。</td></tr><tr><td align="left">NotificationCompat.PRIORITY_HIGH</td><td align="left">高优先级用于重要的通信内容&#xff0c;例如短消息或者聊天&#xff0c;这些都是对用户来说比较有兴趣的。</td></tr><tr><td align="left">NotificationCompat.PRIORITY_DEFAULT</td><td align="left">默认优先级用于没有特殊优先级分类的通知。</td></tr><tr><td align="left">NotificationCompat.PRIORITY_LOW</td><td align="left">低优先级可以通知用户但又不是很紧急的事件。</td></tr><tr><td align="left">NotificationCompat.PRIORITY_MIN</td><td align="left">用于后台消息 (例如天气或者位置信息)。最低优先级通知将只在状态栏显示图标&#xff0c;只有用户下拉通知抽屉才能看到内容。</td></tr></tbody></table>
<h4><a id="_240"></a>进度条通知栏</h4> 
<blockquote> 
 <p>setProgress(int,int,boolean)&#xff1a;设置带进度条的通知参数依次为&#xff1a;进度条最大数值&#xff0c;当前进度&#xff0c;进度是否不确定&#xff1b;<br /> 如果为确定的进度条&#xff1a;调用setProgress(max, progress, false)来设置通知&#xff0c;在更新进度的时候在此发起通知更新progress&#xff0c;并且在下载完成后要移除进度条cancel(int id)。<br /> 如果为不确定&#xff08;持续活动&#xff09;的进度条&#xff0c;这是在处理进度无法准确获知时显示活动正在持续&#xff0c;所以调用setProgress(0, 0, true)。</p> 
</blockquote> 
<pre><code class="prism language-kotlin"> <span class="token keyword">val</span> manager<span class="token operator">:</span> NotificationManager <span class="token operator">&#61;</span> App<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> NotificationManager
 <span class="token keyword">val</span> builder <span class="token operator">&#61;</span> NotificationCompat<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> NotificationHelper<span class="token punctuation">.</span>DOWNLOAD<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setContentTitle</span><span class="token punctuation">(</span><span class="token string">&#34;下载消息&#34;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setContentText</span><span class="token punctuation">(</span><span class="token string">&#34;下载进度&#xff0c;等级LOW&#xff01;&#xff01;&#xff01;&#34;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setWhen</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setLargeIcon</span><span class="token punctuation">(</span>BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>resources<span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_launcher_large<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setAutoCancel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setContentIntent</span><span class="token punctuation">(</span>pendingIntent<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span>NotificationCompat<span class="token punctuation">.</span>PRIORITY_LOW<span class="token punctuation">)</span><span class="token comment">//设置为低优先级&#xff0c;且不设置提示音&#xff0c;防止下载更新通知的时候不断发出提示音</span>
            <span class="token comment">//倒计时模拟下载进度</span>
            <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">CountDownTimer</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onFinish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                   manager<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onTick</span><span class="token punctuation">(</span>millisUntilFinished<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    builder<span class="token punctuation">.</span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> millisUntilFinished <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                    manager<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_272"></a>点击通知栏跳转</h4> 

 <p>setContentIntent(PendingIntent)&#xff1a;设置该方法点击通知栏可以跳转到指定的PendingIntent。<br /> PendingIntent和Intent略有不同&#xff0c;它可以设置执行次数&#xff0c;主要用于远程服务通信、闹铃、通知、启动器、短信中&#xff0c;在一般情况下用的比较少。<br /> 比如这里通过Pending启动Activity&#xff1a;getActivity(Context, int, Intent, int)&#xff0c;当然还可以启动Service或者BroadcastPendingIntent的位标识符(第四个参数)&#xff1a;<br /> FLAG_ONE_SHOT 表示返回的PendingIntent仅能执行一次&#xff0c;执行完后自动取消<br /> FLAG_NO_CREATE 表示如果描述的PendingIntent不存在&#xff0c;并不创建相应的PendingIntent&#xff0c;而是返回NULL<br /> FLAG_CANCEL_CURRENT 表示相应的PendingIntent已经存在&#xff0c;则取消前者&#xff0c;然后创建新的PendingIntent&#xff0c;这个有利于数据保持为最新的&#xff0c;可以用于即时通信的通信场景<br /> FLAG_UPDATE_CURRENT 表示更新的PendingIntent</p> 
